<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Cart</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>


  <!--ORDER SUCCESS MODEL -->
  
  <div id="successModal" class="successModal model-overlay show" style="display:none;">
       <div class="modal-content">
            <!--Animated Check -->
            <div class="success-checkmark">
       
                <div class="check-icon">
                   <span class="icon-line line-tip"></span>
                   <span class="icon-line line-long"></span>
                   <div class="icon-circle"> </div>
                   <div class="icon-fix"></div>
                  
               </div>
           </div>
           
           <!-- Success message  -->
           <h2 class="model-title">Order Placed Successfully!</h2>
           <p class="model-message" id="orderSummary">
           
            Your Order has been placed 
           </p>
           
           <!-- Redirecting info  -->
           <p class="model-redirect">
             Redirecting to orders page... 
           </p>
           
       </div>
  </div>
  
  
  
    <nav class="navbar">
        <div class="navbar-container">
            <a href="/products" class="navbar-brand">ShopMart</a>
            <ul class="navbar-menu">
                <li><a href="/products">Products</a></li>
                <li><a href="/cart">ðŸ›’ Cart</a></li>
                <li><a href="/orders">Orders</a></li>
                <li><a href="/profile">Profile</a></li>
                <li><span th:text="${username}">User</span></li>
                <li>
                    <form th:action="@{/auth/logout}" method="post" style="margin:0;">
                        <button type="submit" class="btn btn-sm btn-outline">Logout</button>
                    </form>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <h1>Shopping Cart</h1>

        <div th:if="${cart == null or cart.items == null or cart.items.isEmpty()}">
            <p>Your cart is empty</p>
            <a href="/products" class="btn btn-primary">Continue Shopping</a>
        </div>

        <div th:if="${cart != null and cart.items != null and !cart.items.isEmpty()}">
            <div style="display:flex; gap:2rem;">
                <div style="flex:2;">
                    <h2>Items</h2>
                    
                    <div th:each="item : ${cart.items}" style="border:1px solid #ddd; padding:1rem; margin-bottom:1rem;">
                        <img th:src="${item.productImageUrl}" alt="Product" style="width:100px; height:100px;" onerror="this.src='https://via.placeholder.com/100'" />
                        
                        <h3 th:text="${item.productName}">Product</h3>
                        <p>Price: Rs. <span th:text="${item.productPrice}">0</span></p>
                        <p>Quantity: <span th:text="${item.quantity}">0</span></p>
                        <p><strong>Subtotal: Rs. <span th:text="${item.productPrice * item.quantity}">0</span></strong></p>
                        
                        <form th:action="@{/cart/remove}" method="post" style="display:inline;">
                            <input type="hidden" name="cartItemId" th:value="${item.id}" />
                            <button type="submit" class="btn btn-danger btn-sm">Remove</button>
                        </form>
                    </div>
                </div>

                <div style="flex:1;">
                    <h2>Summary</h2>
                    <p>Items: <span th:text="${cart.items.size()}">0</span></p>
                    <p>Shipping: FREE</p>
                    <p><strong>Total: Rs. <span th:text="${cart.totalPrice}">0</span></strong></p>
                    
                    <form th:action="@{/cart/place-order}" method="post">
                        <button type="submit" class="btn btn-primary btn-block btn-lg">Place Order</button>
                    </form>
                    
                    <a href="/products" class="btn btn-outline btn-block">Continue Shopping</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3 class="footer-title">ShopMart</h3>
                    <p class="footer-text">Your one-stop shop for amazing products at great prices.</p>
                </div>
                
                <div class="footer-section">
                    <h4 class="footer-heading">Quick Links</h4>
                    <ul class="footer-links">
                        <li><a href="/products">Products</a></li>
                        <li><a href="/cart">Cart</a></li>
                        <li><a href="/orders">My Orders</a></li>
                        <li><a href="/profile">Profile</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4 class="footer-heading">Customer Service</h4>
                    <ul class="footer-links">
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">Shipping Info</a></li>
                        <li><a href="#">Returns</a></li>
                        <li><a href="#">FAQ</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4 class="footer-heading">Connect With Us</h4>
                    <div class="footer-social">
                        <a href="#" class="social-link">Facebook</a>
                        <a href="#" class="social-link">Twitter</a>
                        <a href="#" class="social-link">Instagram</a>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2026 ShopMart. All rights reserved.</p>
            </div>
        </div>
    </footer>

    
    <script>
    //check if order was placed successfully
    const urlParams= new URLSearchParams(window.location.search);
    
    if(urlParams.has('success') && urlParams.get('success') === 'true'){
    	const itemCount =urlParams.get('items') || '0';
    	const total=urlParams.get('total') || '0';
    	
    	
    	//update modal message
    	document.getElementById('orderSummary').textContent=
    		`Your order of Rs.${total} with ${itemCount} item(s) has been placed !`;
    		
    		//show model
    		showSuccessModel();
    
    }
    
    function showSuccessModel(){
    	const modal = document.getElementById('successModal');
    	modal.style.display='flex';
    	
    	//Add animation class
    	setTimeout(()=>{
    		modal.classList.add('show');
    	},10);
    	
    	//Redirect to order page  after 3 seconds
    	setTimeout(()=>{
    		window.location.href='/orders';
    	},3000);
    }
    
    
    </script>
</body>
</html>